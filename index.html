<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Test AWS Lambda</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Creepster&family=Sofia&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="title">
      <h1>My Simple Inventory App</h1>
    </div>
    <table id="lambda-info">
      <thead>
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Name</th>
          <th scope="col">Price</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
        <!-- loaded with AJAX -->
      </tbody>
    </table>

    <hr />

    <form class="add-item-form">
      <h2>Add New Item to Database</h2>
      <div>
        <label for="item-id">ID:</label>
        <input
          type="number"
          id="item-id"
          name="id"
          placeholder="Placeholder"
          required
        />
      </div>
      <div>
        <label for="item-name">Name:</label>
        <input
          type="text"
          id="item-name"
          name="name"
          placeholder="Placeholder"
          required
        />
      </div>
      <div>
        <label for="item-price">Price:</label>
        <input
          type="number"
          id="item-price"
          name="price"
          placeholder="Placeholder"
          required
        />
      </div>
      <button id="send-data">Add Item</button>
    </form>

    <script>
      document.querySelector(".add-item-form").onsubmit = function (e) {
        e.preventDefault();

        const id = document.getElementById("item-id").value;
        const name = document.getElementById("item-name").value;
        const price = document.getElementById("item-price").value;

        let xhr = new XMLHttpRequest();
        xhr.open(
          "PUT",
          "https://plx7aejwka.execute-api.us-east-2.amazonaws.com/items"
        );
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onload = function () {
          loadTable();
        };
        xhr.send(
          JSON.stringify({
            id: `${id}`,
            price: `${price}`,
            name: `${name}`,
          })
        );
      };
    </script>

    <script>
      function loadTable() {
        let xhr = new XMLHttpRequest();
        xhr.addEventListener("load", function () {
          const data = JSON.parse(xhr.response);
          const tbody = document.querySelector("tbody");
          tbody.innerHTML = "";
          data.sort((a, b) => Number(a.id) - Number(b.id));
          data.forEach((item) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <th scope="row">${item.id}</th>
                <td>${item.name}</td>
                <td>${item.price}</td>
                <td><button class="delete-data" data-id="${item.id}">Delete</button></td>
              `;
            tbody.appendChild(tr);

            const deleteButton = tr.querySelector(".delete-data");
            deleteButton.onclick = function () {
              const id = this.getAttribute("data-id");
              let dxhr = new XMLHttpRequest();
              dxhr.open(
                "DELETE",
                `https://plx7aejwka.execute-api.us-east-2.amazonaws.com/items/${id}`
              );
              dxhr.setRequestHeader("Content-Type", "application/json");
              dxhr.onload = function () {
                loadTable();
              };
              dxhr.send();
            };
          });
        });
        xhr.open(
          "GET",
          "https://plx7aejwka.execute-api.us-east-2.amazonaws.com/items"
        );
        xhr.send();
      }
      window.onload = loadTable;
    </script>
  </body>
</html>
